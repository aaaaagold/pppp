<!DOCTYPE html>
<html>
<head>
<style>
.btn:hover{background-color:rgba(123,123,0,0.5);}
.inaline>*{display:inline-block;}
.sparse22>*{margin:22px;}
</style>
<script>
var AudioContext = window.AudioContext || window.webkitAudioContext;
let q={},d=document;
q.ce=function(h){return d.createElement(h);};
q.ge=function(i){return d.getElementById(i);};
Array.prototype.back=function(){return this.length==0?undefined:this[this.length-1];};
HTMLElement.prototype.ac=function(c){this.appendChild(c); return this;};
HTMLElement.prototype.ga=function(a){return this.getAttribute(a);};
HTMLElement.prototype.sa=function(a,v){this.setAttribute(a,v);return this;};
HTMLElement.prototype.at=function(t){this.ac(d.createTextNode(t));return this;};
HTMLElement.prototype.ra=function(n){let arr=this.childNodes;while(arr.length!=0&&arr.length>n)this.removeChild(arr[arr.length-1]);return this;};
</script>
</head>
<body>
<div id="root"><div id="keys"></div><div>currPitchDelta <input id="currPitchDelta" type=number value=0></div><div id="btns" class="sparse22"></div><div id="rec">[]</div></div>
<script src="prepare.js"></script>
<script src="rnd.js"></script>
<script>
document.body.addEventListener('keydown',io_keydown);
document.body.addEventListener('keyup',io_keyup);

q.ge("keys").at(JSON.stringify(keysOri));
q.ge("btns").ac(
	(()=>{
		let div=q.ce("div").sa("class","btn").at("input and play record");
		div.onclick=()=>{
			let rec=prompt("paste your record below");
			lastInput=JSON.parse(rec);
			if(rec!==null) playseq(lastInput);
		};
		return div;
	})()
).ac(
	(()=>{
		let div=q.ce("div").sa("class","btn").at("stop playing record");
		div.onclick=()=>{playseq.stop();};
		return div;
	})()
).ac(
	(()=>{
		let div=q.ce("div").sa("class","btn").at("replay last input record");
		div.onclick=()=>{playseq(lastInput);};
		return div;
	})()
).ac(
	(()=>{
		let div=q.ce("div").sa("class","btn").at("clear record");
		div.onclick=()=>{seqs.push(seq);seq=[];};
		return div;
	})()
).ac(
	(()=>{
		let div=q.ce("div").sa("class","btn").at("update record");
		div.onclick=()=>{putseq(q.ge("rec"),seq);};
		return div;
	})()
).ac(
	(()=>{
		let div=q.ce("div").sa("class","btn").at("update record (time from 0)");
		div.onclick=()=>{putseq(q.ge("rec"),seq_dlt2abs(seq_abs2dlt(seq),0));};
		return div;
	})()
).ac(
	(()=>{
		let div=q.ce("div").sa("class","btn").at("update record (delta timing)");
		div.onclick=()=>{putseq(q.ge("rec"),seq_abs2dlt(seq));};
		return div;
	})()
).ac(
	(()=>{
		let div=q.ce("div").sa("class","btn").at("random"),cnt=q.ce("input").sa("type","number").sa("value","300");
		let last_rpl=q.ce("div").sa("class","btn").at("replay last random");
		let last_abs=q.ce("div").sa("class","btn").at("update last random");
		let last_abs0=q.ce("div").sa("class","btn").at("update last random (time from 0)");
		let last_dlt=q.ce("div").sa("class","btn").at("update last random (delta timing)");
		div.onclick=()=>{
			div.last_time=new Date().getTime()-baseTime;
			div.last_seq=rnd(parseInt(cnt.value));
			playseq(div.last_seq);
			// ----
			arr=div.last_seq;
			console.log(JSON.stringify(arr));
			// ----
			//arr2=arr.concat(shift(arr,6)).concat(arr);//.concat(shift(arr,-12));
			//console.log(JSON.stringify(arr2));
		};
		last_rpl.onclick=()=>{playseq.stop();playseq(div.last_seq);};
		last_abs.onclick=()=>{putseq(q.ge("rec"),seq_dlt2abs(div.last_seq,div.last_time));};
		last_abs0.onclick=()=>{putseq(q.ge("rec"),seq_dlt2abs(div.last_seq,0));};
		last_dlt.onclick=()=>{putseq(q.ge("rec"),div.last_seq);};
		return q.ce("div").ac(div).at("count ").ac(cnt).ac(last_rpl).ac(last_abs).ac(last_abs0).ac(last_dlt);
	})()
);
</script>
</body>
</html>
