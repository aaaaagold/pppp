<!DOCTYPE html>
<html>
<head>
<style>
.btn:hover{background-color:rgba(123,123,0,0.5);}
</style>
<script>
var AudioContext = window.AudioContext || window.webkitAudioContext;
let q={},d=document;
q.ce=function(h){return d.createElement(h);};
q.ge=function(i){return d.getElementById(i);};
Array.prototype.back=function(){return this.length==0?undefined:this[this.length-1];};
HTMLElement.prototype.ac=function(c){this.appendChild(c); return this;};
HTMLElement.prototype.ga=function(a){return this.getAttribute(a);};
HTMLElement.prototype.sa=function(a,v){this.setAttribute(a,v);return this;};
HTMLElement.prototype.at=function(t){this.ac(d.createTextNode(t));return this;};
HTMLElement.prototype.ra=function(n){let arr=this.childNodes;while(arr.length!=0&&arr.length>n)this.removeChild(arr[arr.length-1]);return this;};
</script>
</head>
<body>
<div id="root"><div id="keys"></div><div>currPitchDelta <input id="currPitchDelta" type=number value=0></div><div id="btns"></div><div id="rec">[]</div></div>
<script src="prepare.js"></script>
<script src="rnd.js"></script>
<script>
document.body.addEventListener('keydown',io_keydown);
document.body.addEventListener('keyup',io_keyup);

q.ge("keys").at(JSON.stringify(keysOri));
q.ge("btns").ac(
	(()=>{
		let div=q.ce("div").sa("class","btn").at("input and play record");
		div.onclick=()=>{
			let rec=prompt("paste your record below");
			lastInput=JSON.parse(rec);
			if(rec!==null) playseq(lastInput);
		};
		return div;
	})()
).ac(
	(()=>{
		let div=q.ce("div").sa("class","btn").at("stop playing record");
		div.onclick=()=>{
			stopseq|=1;
			for(let x=0;x!==keysDown.length;++x) if(keysDown[x]) keyup(x);
			for(let i in queuingseq) clearTimeout(queuingseq[i]);
		};
		return div;
	})()
).ac(
	(()=>{
		let div=q.ce("div").sa("class","btn").at("replay last input record");
		div.onclick=()=>{ playseq(lastInput); };
		return div;
	})()
).ac(
	(()=>{
		let div=q.ce("div").sa("class","btn").at("clear record");
		div.onclick=()=>{seqs.push(seq);seq=[];};
		return div;
	})()
).ac(
	(()=>{
		let div=q.ce("div").sa("class","btn").at("update record");
		div.onclick=()=>{q.ge("rec").ra(0).at(JSON.stringify(seq))};
		return div;
	})()
).ac(
	(()=>{
		let div=q.ce("div").sa("class","btn").at("update record (delta timing)");
		div.onclick=()=>{
			if(!seq.length) return;
			let output=[[seq[0][0],seq[0][1],100,1]];
			for(let x=1;x!==seq.length;++x) output.push([seq[x][0],seq[x][1],(seq[x][2]-seq[x-1][2]),1]);
			q.ge("rec").ra(0).at(JSON.stringify(output));
		};
		return div;
	})()
).ac(
	(()=>{
		let div=q.ce("div").sa("class","btn").at("random");
		div.onclick=()=>{
			arr=rnd();
			arr2=arr.concat(shift(arr,6)).concat(arr);//.concat(shift(arr,-12));
			playseq(arr);
			console.log(JSON.stringify(arr));
			console.log(JSON.stringify(arr2));
		};
		return div;
	})()
);
</script>
</body>
</html>
